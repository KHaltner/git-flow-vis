"use strict";var GitFlowVisualize=function(){function e(){}function t(e){var t=this;t.id=e,t.name=e,t.commits=[];var n=null,a=[];t.combine=function(e){n=e,e.receive(t)},t.receive=function(e){a.push(e)},t.isVisible=function(){return null===n},t.renderPos=function(){return n?n.id:t.id};var i=function(){return a.concat(t)},s=function(e){var t=r.commits[e];return t&&t.visible===!0};t.firstVisible=function(){var e=_.findLast(t.commits,s);return r.commits[e]},t.lastVisible=function(){var e=_.find(t.commits,s);return r.commits[e]},t.firstRenderedCommit=function(){if(n)return null;var e=i();return e.reduce(function(e,t){var n=t.firstVisible();return n&&(!e||e.orderNr<n.orderNr)?n:e},null)},t.lastRenderedCommit=function(){if(n)return null;var e=i();return e.reduce(function(e,t){var n=t.lastVisible();return!e||e.orderNr>n.orderNr?n:e},null)},t.finallyMergesToColumn=function(){var e=this.lastVisible();if(!e)return null;var t=e.children;if(0===t.length)return null;var n=r.columns[r.commits[t[0]].columns[0]];return n}}function n(e,t){var n=this;e=e||w;var r=e.length()+1,a=0;n.setStepScore=function(e){a=e},n.members={},n.members.prototype=e.members,n.members[t]=!0,n.last=function(){return t};var i=null;return n.score=function(){return null===i&&(i=e.score()),i+a},n.length=function(){return r},n.asArray=function(){var n=e.asArray().slice(0);return n.push(t),n},n.contains=function(e){return e in n.members},n}var r,a={},i={style:"none",root:null},s={rowHeight:35},o={DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR"},l={},c=CryptoJS.MD5,u={drawElem:null,masterRef:"refs/heads/master",developRef:"refs/heads/develop",featurePrefix:"refs/heads/feature/",releasePrefix:"refs/heads/release/",hotfixPrefix:"refs/heads/hotfix/",releaseZonePattern:/^refs\/heads\/bugfix/,releaseTagPattern:/^refs\/tags\/\d+(\.\d+)+$/,showSpinner:function(){},hideSpinner:function(){},dataCallback:function(e){l.dataCallback||(console.log(o.WARN,"The required option 'dataCallback' is missing, please provide a method to retrieve commit data"),l.dataCallback=!0),e({})},moreDataCallback:function(e,t){l.moreDataCallback||(console.log(o.WARN,"The required option 'moreDataCallback' is missing, please provide a method to retrieve commit data"),l.moreDataCallback=!0),t({})},dataProcessed:function(){},log:function(e,t){},createCommitUrl:function(){return"#"},createAuthorAvatarUrl:_.memoize(function(e){return"https://secure.gravatar.com/avatar/"+c(e.emailAddress)+".jpg?s=48&amp;d=mm"},function(e){return e.emailAddress}),hiddenBranches:[]},m=function(e){var t={};if(r=t,t.commits={},t.openEnds={},!e.commits||!e.branches||!e.tags)throw"raw data should have a commits, branches and  tags property";for(var n=0;n<e.commits.length;n++)for(var i=0;i<e.commits[n].values.length;i++){var s=e.commits[n].values[i];delete s.columns,delete s.labels,delete s.orderTimestamp,delete s.children,t.commits[s.id]=s}for(var l in t.commits){var s=t.commits[l];s.orderTimestamp=s.authorTimestamp,s.children||(s.children=[]);for(var n=s.parents.length-1;n>=0;n--){var c=t.commits[s.parents[n].id];c?d(c,s.id):(t.openEnds[s.id]=t.openEnds[s.id]||[],t.openEnds[s.id].push(s.parents[n].id))}}t.branches=_.filter(e.branches.values,function(e){return u.hiddenBranches.indexOf(e.id)===-1}),t.hiddenBranches=_.filter(e.branches.values,function(e){return u.hiddenBranches.indexOf(e.id)>-1});for(var n=0;n<t.branches.length;n++){var m=t.branches[n],s=t.commits[m.latestChangeset];s?(s.labels=s.labels||[],s.labels.push(m.id),m.lastActivity=s.authorTimestamp):(t.openEnds.asap=t.openEnds.asap||[],t.openEnds.asap.push(m.latestChangeset))}var h=function(e,n){if(e&&e.orderTimestamp<=n){u.log(o.DEBUG,"fixing orderTimestamp for "+e.displayId+" "+e.orderTimestamp+" -> "+n+1),e.orderTimestamp=n+1;for(var r=0;r<e.children.length;r++)h(t.commits[e.children[r]],e.orderTimestamp)}};for(var p in t.commits)for(var g=t.commits[p],v=0;v<g.parents.length;v++){var c=t.commits[g.parents[v].id];c&&h(g,c.orderTimestamp)}t.tags=e.tags.values;for(var n=0;n<t.tags.length;n++){var b=t.tags[n],s=t.commits[b.latestChangeset];s&&(s.labels=s.labels||[],s.labels.push(b.id))}t.labels=t.tags.concat(t.branches),t.chronoCommits=[];for(var l in t.commits)t.chronoCommits.push(l);t.chronoCommits.sort(function(e,n){return t.commits[n].orderTimestamp-t.commits[e].orderTimestamp}),t.visibleCommits=[];for(var y=0,n=0;n<t.chronoCommits.length;n++){var s=t.commits[t.chronoCommits[n]];if(s.labels&&s.labels.length)s.visible=!0;else{var x=_.filter(_.map(s.children,function(e){return t.commits[e]}),function(e){return e.visible});s.visible=x.length>0}s.visible?(s.orderNr=y,t.visibleCommits.push(t.chronoCommits[n]),y++):delete s.orderNr}return f(t),t.openEnds.asap&&setTimeout(function(){a.drawing.lazyLoad()},1),t},d=function(e,t){e.children=e.children||[],e.children.push(t)},f=function(){h(),p(),g(),v(),b("d"),b("f"),b("r")},h=function(){var e=_.filter(r.branches,function(e){return e.id==u.masterRef});if(0!=e.length){for(var t=x(e[0].latestChangeset,_.map(_.filter(r.tags,function(e){return e.id.match(u.releaseTagPattern)}),function(e){return e.latestChangeset}),r),n=0;n<t.length;n++)y(t[n],"m",r);for(;;){var a=r.columns.m.commits,i=a[a.length-1],s=r.commits[i].parents;if(!s||0==s.length)break;if(!y(s[0].id,"m",r))break}}},p=function(){var e=_.filter(r.branches,function(e){return e.id==u.developRef});if(0!=e.length){for(var t=N(e[0].latestChangeset),n=0;n<t.length;n++)y(t[n],"d0",r);for(var a=u.developRef.substring(u.developRef.lastIndexOf("/")+1),i=new RegExp("Merge branch '[^']+' (of \\S+ )?into "+a+"$"),s=1,n=0;n<r.chronoCommits.length;n++){var o=r.commits[r.chronoCommits[n]];o.columns||i.test(o.message)&&(y(o.id,"d"+s),s++)}}},g=function(){for(var e=0,t=0;t<r.chronoCommits.length;t++){var n=r.commits[r.chronoCommits[t]];if(!n.columns){var a=_.filter(n.children,function(e){var t=r.commits[e],n=t.columns&&("m"==t.columns[0]||"d"==t.columns[0][0]);if(n)return!1;r.columns[t.columns[0]]||u.log(o.WARN,"huh");var a=r.columns[t.columns[0]].commits;return t.id==a[a.length-1]});if(0==a.length)y(n.id,"c"+e,r),e++;else{var i=r.commits[a[0]];i&&i.columns?(y(n.id,i.columns[0],r),i._hasColumnChild=!0):u.log(o.INFO,"Couldn't find appropriate parent")}}}},v=function(){for(var e=0;e<r.branches.length;e++){var t=r.branches[e];if(0===t.id.indexOf(u.releasePrefix)||0===t.id.indexOf(u.hotfixPrefix)||0===t.id.match(u.releaseZonePattern)){var n=r.commits[t.latestChangeset];if(n){var a=r.columns[n.columns[0]];"c"===a.name[0]&&(a.name="r"+a.name.substring(1))}}}for(var e=0;e<r.branches.length;e++){var t=r.branches[e];if(0===t.id.indexOf(u.featurePrefix)){var n=r.commits[t.latestChangeset];if(n){var a=r.columns[n.columns[0]];"c"===a.name[0]&&(a.name="f"+a.name.substring(1))}}}for(var i in r.columns){var a=r.columns[i];if("m"!=i&&"d"!=i[0]&&"r"!=i[0]){var s=_.flatMap(a.commits,function(e){return r.commits[e].children}),o=_.filter(s,function(e){var t=r.commits[e];return t.visible&&t.columns&&"m"==t.columns[0]});if(o.length>0)a.name="r"+a.name.substring(1);else{var l=_.flatMap(a.commits,function(e){return r.commits[e].parents}),c=_.filter(l,function(e){var t=r.commits[e.id];return!!t&&(t.visible&&t.columns&&"m"==t.columns[0])});if(c.length>0)a.name="r"+a.name.substring(1);else{var m=a.lastVisible();m&&(m.labels&&m.labels.filter(function(e){return 0==e.indexOf(u.releasePrefix)||0==e.indexOf(u.hotfixPrefix)||u.releaseZonePattern.test(e)}).length>0?a.name="r"+a.name.substring(1):m.labels&&m.labels.filter(function(e){return 0==e.indexOf(u.featurePrefix)}).length>0&&(a.name="f"+a.name.substring(1)))}}}}for(;;){for(var d=!1,f=_.filter(_.map(Object.keys(r.columns),function(e){return r.columns[e]}),function(e){return"c"==e.name[0]}),h=0;h<f.length;h++){var a=f[h],p=a.finallyMergesToColumn(),g=p?p.name[0]:"f";"c"!=g&&("d"==g&&(g="f"),a.name=g+a.name.substring(1),d=!0)}if(!d)break}for(var v=_.filter(_.map(Object.keys(r.columns),function(e){return r.columns[e]}),function(e){return"f"==e.name[0]}),b=_.filter(v,function(e){return e.commits.length>9}),y=1,x=0;x<b.length;x++){var w=b[x];w.group=y,y++}for(var x=0;x<v.length;x++){var w=v[x],m=r.commits[w.commits[0]];if(m.children&&m.children.length>0){var C=r.columns[r.commits[m.children[0]].columns[0]];C.group&&(w.group=C.group)}else{var N=r.commits[w.commits[w.commits.length-1]];if(N.parents&&N.parents.length>0){var E=r.commits[N.parents[0].id];if(E){var A=r.columns[E.columns[0]];A.group&&(w.group=A.group)}}}}},b=function(e){for(var t=_.map(r.columns,function(e){return e}).filter(function(t){return t.name[0]==e}),n={},a=0;a<t.length;a++)t[a].group&&(n[t[a].group]=!0);n=Object.keys(n),n.unshift(null);for(var i=0;i<n.length;i++)for(var s=n[i],o=_.filter(t,function(e){return null===s?"undefined"==typeof e.group:e.group==s}),a=0;a<o.length;a++)for(var l=o[a],c=0;c<a;c++){var u=o[c];if(u.isVisible()){var m=u.firstRenderedCommit();m&&m.parents.length>0&&r.commits[m.parents[0].id]&&(m=r.commits[m.parents[0].id]);var d=l.lastRenderedCommit();d&&d.children.length>0&&r.commits[d.children[0]]&&(d=r.commits[d.children[0]]),(!d||!m||d.orderNr>=m.orderNr)&&(l.combine(u),c=a)}}},y=function(e,n){r.columns||(r.columns={}),n in r.columns||(r.columns[n]=new t(n));var a=r.commits[e];return!!a&&(a.columns=a.columns||[],a.columns.push(n),r.columns[n].commits.push(e),!0)},x=function(e,t){var n=function(e,n){return t.indexOf(n)>-1?1e3:-1},r=C(e,n);return r.asArray()},w={length:function(){return 0},score:function(){return 0},asArray:function(){return[]},contains:function(){return!1},members:{}},C=function(e,t){var a=t||function(){return-1},i=[],s={},o=r.commits[e];if(!o)return w;var l=new n(null,e),c=0;for(s[o.orderNr]=l,c=o.orderNr,i.push(l);i.length>0;)for(var u=i.shift(),m=r.commits[u.last()],d=0;d<m.parents.length;d++){var f=r.commits[m.parents[d].id];if(f){var h=a(u,f.id);if(h!==!1&&!(s[f.orderNr]&&s[f.orderNr].score()>u.score()+h)){var p=new n(u,f.id);p.setStepScore(h),i.push(p),s[f.orderNr]=p,c<f.orderNr&&(c=f.orderNr)}}}var g=Object.keys(s);return g.sort(function(e,t){return e&&t?s[t].score()-s[e].score():0}),s[g[0]]},N=function(e){var t=u.developRef.substring(u.developRef.lastIndexOf("/")+1),n=u.releasePrefix.split("/")[2],a=u.hotfixPrefix.split("/")[2],i=new RegExp("Merge branch '("+t+")' of http:\\/\\/\\S+ into \\1"),s=new RegExp("Merge branch '[^']+' into "+t+"$"),o=new RegExp("Merge branch '("+n+"|"+a+")[^']+' into "+t+"\\b"),l=function(e,t){var n=r.commits[t],a=r.commits[e.last()];if(n.columns&&"m"==n.columns[0])return!1;var l=n.children.filter(function(t){return e.contains(t)});return 1==l.length&&(i.test(n.message)?0:o.test(n.message)?20:s.test(n.message)?5:a.parents.length>1&&n.id==a.parents[0].id?1:-.1)},c=C(e,l);return c.asArray()};a.state=function(){var e=JSON.stringify(E);return e};var E=null,A={commits:!0,labels:!0},O=[];a.draw=function(e,t){if(e)try{e instanceof HTMLElement||(t=e,e=null)}catch(n){"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument||(t=e,e=null)}u=_.extend(u,t),u.drawElem=u.drawElem||e,u.drawElem?u.drawElem instanceof d3.selection||(u.drawElem=d3.select(u.drawElem)):u.drawElem=d3.select("body").append("div").attr("id","gitflow-visualize"),u.showSpinner(),u.dataCallback(function(e){E=e,u.hideSpinner(),R()})};var k=function(e){var t=_.filter(e,function(e){return!(e in r.commits)});t.length>0&&(E.commits.push(e),A.commits=!0)},D=function(e){var t=E.branches.values.reduce(function(e,t){return e[t.id]=t,e},{}),n=!1;return e.values.forEach(function(e){var r=e.id;r in t?t[r].latestChangeset!==e.latestChangeset&&(n=!0,t[r].latestChangeset=e.latestChangeset):(E.branches.values.push(e),n=!0)}),n&&(A.labels=!0),n},z=function(){setTimeout(function(){u.log(o.INFO,"Starting mini draw"),e(),u.drawElem&&(a.drawing.drawGraph(u.drawElem),a.drawing.updateHighlight())})},R=function(){u.showSpinner(),r=setTimeout(function(){u.log(o.INFO,"Starting full new draw"),m(E),A.commits=!1,A.labels=!1,u.log(o.INFO,"Done cleaning/transforming data"),u.hideSpinner(),u.dataProcessed(r),u.drawElem&&(a.drawing.drawGraph(u.drawElem),a.drawing.updateHighlight()),u.log(o.INFO,"Done drawing (animations still in progress)")},10)};a.drawing=function(){var e={};e.updateHighlight=function(){var e=function(e){if(!e||0==e.length)return d3.selectAll(".commit-msg").classed("dim",!1).classed("highlight",!1),d3.selectAll(".commit-dot").classed("dim",!1),void d3.selectAll(".arrow").style("opacity","1");for(var t in r.commits)e.indexOf(t)>-1?(d3.selectAll("#msg-"+t).classed("dim",!1).classed("highlight",!0),d3.selectAll("#commit-"+t).classed("dim",!1),d3.selectAll(".arrow-to-"+t).style("opacity","1")):(d3.selectAll("#msg-"+t).classed("dim",!0).classed("highlight",!1),d3.selectAll("#commit-"+t).classed("dim",!0),d3.selectAll(".arrow-to-"+t).style("opacity","0.2"))};switch(d3.selectAll(".commit-msg.selected").classed("selected",!1),i.style){case"none":e([]);break;case"ancestry":var t=d3.select("#msg-"+i.root),n={},a=function(e){var t=r.commits[e];if(t&&!n[e]){n[e]=!0;for(var i=0;i<t.parents.length;i++)a(t.parents[i].id)}};t.classed("selected",!0),a(i.root),e(Object.keys(n))}};var t=function(e){var t=_.map(e,function(e,t){return t});return t.sort(firstBy(function(t,n){var r=function(t){return{m:1,d:3,f:4,r:2}[e[t].name[0]]||5};return r(t)-r(n)}).thenBy(function(e,t){return(r.columns[e].group||0)-(r.columns[t].group||0)}).thenBy(function(e,t){if("f"==r.columns[e].name[0]){var n=r.columns[e].commits,a=r.columns[t].commits;return r.commits[n[0]].orderNr-r.commits[a[0]].orderNr}return t>e?-1:1})),t},n=function(e,t){for(var n={gutter:.7,line:1,developLine:.4},a={},i="",s=0,o={},l=0;l<e.length;l++){var c=e[l],u=r.columns[c];if(u.isVisible()){var m=c[0];i!=m&&(s+=n.gutter),s+="d"==m?n.developLine:n.line,o[c]=s,i=m}else a[c]=u.renderPos()}var d=d3.scale.linear().domain([0,s]).range([0,Math.min(t,20*s)]);return function(e){var t=0;return"+"==e[e.length-1]&&(e=e.substring(0,e.length-1),t=.5),e in a&&(e=a[e]),d(o[e]+t)}};e.drawGraph=function(d){function f(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}var h=Math.max(800,r.visibleCommits.length*s.rowHeight),p={width:500,height:h},g=20,v=d.select("svg>g");if(v.empty()){var b=d.append("div");b.attr("class","commits-graph-container"),b.append("div").attr("class","scroll-container").append("div").attr("class","scrollme");var v=b.append("svg").attr("class","commits-graph").append("g").attr("transform","translate("+g+",0)"),y=v.append("g").attr("id","bgLayer"),x=v.append("g").attr("id","arrowsLayer"),w=v.append("g").attr("id","mainLinesLayer"),C=v.append("g").attr("id","commitsLayer")}d.select("svg").attr("width",p.width+2*g).attr("height",p.height+2*g),d.select("div.scrollme").style("width",p.width+2*g+"px");var N=d.select(".commits-graph-container"),E=d.select(".scroll-container");N.on("scroll",function(){E.node().scrollLeft=N.node().scrollLeft}),E.on("scroll",function(){N.node().scrollLeft=E.node().scrollLeft}),y=v.select("g#bgLayer"),x=v.select("g#arrowsLayer"),w=v.select("g#mainLinesLayer"),C=v.select("g#commitsLayer");var D=t(r.columns),z={master:{prefix:"m"},releases:{prefix:"r"},develop:{prefix:"d"},features:{prefix:"f"}};for(var B in z){var P=D.filter(function(e){return r.columns[e].name[0]===z[B].prefix});0!=P.length?(z[B].first=P[0],z[B].last=P[P.length-1]):delete z[B]}var L=n(D,p.width,r.columnMappings),H=d3.scale.linear().domain([0,r.visibleCommits.length]).range([60,60+r.visibleCommits.length*s.rowHeight]),M=d3.svg.line().x(function(e){return L(e.x)}).y(function(e){return H(e.y)}),S=function(e){var t=r.commits[e.c],n=r.commits[e.p];if(!t||!n||!t.visible)return null;var a=n.orderNr-.5,i=t.columns[0],s=null,o=null,l=r.columns[t.columns[0]];if(!l)return null;var c=r.columns[n.columns[0]];if(l.id!=c.id){var u=c.commits[c.commits.indexOf(n.id)-1];if(!u||r.commits[u].orderNr<t.orderNr)a=t.orderNr+.5,i=n.columns[0];else{var m=l.commits[l.commits.indexOf(t.id)+1];!m||r.commits[m].orderNr>n.orderNr||(o=t.columns[0]+"+",s=n.orderNr-.5,i=t.columns[0]+"+",a=t.orderNr+.5)}}o||(o=i),s||(s=a);var d=[{x:t.columns[0],y:t.orderNr},{x:i,y:a},{x:o,y:s},{x:n.columns[0],y:n.orderNr}];return M(d)},G=_.flatMap(d3.values(r.commits).filter(function(e){return e.visible}),function(e){return e.parents.map(function(t){return{p:t.id,c:e.id}})}),I=x.selectAll(".arrow").data(G,function(e){return"a-"+e.p+"-"+e.c}),V=I.enter().append("g").attr("class",function(e){return"arrow arrow-to-"+e.c});V.append("path").attr("stroke-linejoin","round").attr("class","outline"),V.append("path").attr("stroke-linejoin","round").attr("class",function(e){return"branch-type-"+c(e.c,e.p)});var j=I.selectAll("g>path");j.transition().duration(800).attr("d",S),I.exit().remove();var U=y.selectAll(".branch").data(d3.values(r.columns).filter(function(e){return e.isVisible()}));U.enter().append("g").attr("class","branch").append("line"),U.select("g>line").transition().attr("class",function(e){return"branch-line "+e.name}).attr("x1",function(e){return L(e.id)}).attr("x2",function(e){return L(e.id)}).attr("y1",H(0)).attr("y2",p.height),U.exit().remove();var U=w.selectAll(".branch").data(d3.values(r.columns).filter(function(e){return e.isVisible()&&("d0"===e.id||"m"===e.id)}));U.enter().append("g").attr("class","branch").append("line"),U.select("g>line").transition().attr("class",function(e){return"branch-line "+e.name}).attr("x1",function(e){return L(e.id)}).attr("x2",function(e){return L(e.id)}).attr("y1",H(0)).attr("y2",p.height);var F=C.selectAll(".commit").data(d3.values(r.commits).filter(function(e){return e.visible}),function(e){return"c-"+e.id});F.enter().append("g").attr("class","commit").append("circle").attr("class","commit-dot").attr("r",5),F.exit().remove(),F.select("g>circle").transition().duration(800).attr("cx",function(e){return L(e.columns[0])}).attr("cy",function(e){return H(e.orderNr)}).attr("id",function(e){return"commit-"+e.id});var Y=y.selectAll(".legenda-label").data(Object.keys(z)),W=Y.enter(),q=W.append("g").attr("class",function(e){return"legenda-label "+z[e].prefix}).append("g").attr("transform",function(e){var t=z[e].first==z[e].last?-10:0;return"translate("+(L(z[e].first)+t)+", "+(H(0)-20)+") rotate(-40)"});q.append("rect").attr("width",60).attr("height",15).attr("rx","2"),q.append("text").attr("y","12").attr("x","3").text(function(e){return e}),Y.select("g").transition().attr("transform",function(e){var t=z[e].first==z[e].last?-10:0;return"translate("+(L(z[e].first)+t)+", "+(H(0)-20)+") rotate(-40)"});var X=d.select("div.messages");X.empty()&&(X=d.append("div").attr("class","messages"),X.append("div").attr("class","context-menu"));var Z=d.select("div.gutter");if(Z.empty()){Z=d.append("div").attr("class","gutter"),Z.append("div").attr("class","gutterline");var $=!1,J=0,K=null;Z.on("mousedown",function(){$||($=!0,J=d3.event.pageX,K=Z.style("margin-left"),K=parseInt(K.substring(0,K.indexOf("px"))),d3.event.stopPropagation(),d3.event.preventDefault())}),d3.select("body").on("mouseup",function(){if($){var e=d3.event.pageX-J;Z.style("margin-left",e+K+"px");var t=d.select(".commits-graph-container");t.style("width",e+K+2+"px"),d.select("div.scroll-container").style("width",e+K+"px"),X.style("padding-left",e+K+10+"px")}$=!1}),d3.select("body").on("mousemove",function(){if($){var e=d3.event.pageX-J;Z.style("margin-left",e+K+"px"),d3.event.stopPropagation()}})}Z.style("height",p.height+"px");var Q=X.select("div.msg-header");Q.empty()&&(Q=X.append("div").attr("class","msg-header"),Q.append("span").attr("class","branch-btn label aui-lozenge aui-lozenge-subtle").on("click",function(){var e=[["Show all",function(){u.hiddenBranches=[],R()}]];null!==T&&e.push(["Change...",T]);var t=d3.mouse(X.node());m.show(e,t[0],t[1])}));var ee=r.branches.length+r.hiddenBranches.length+" branches";r.hiddenBranches.length>0&&(ee+=" ("+r.hiddenBranches.length+" hidden)"),Q.select("span.branch-btn").text(ee);var te=X.selectAll(".commit-msg").data(d3.values(r.commits).filter(function(e){return e.visible}),function(e){return"msg-"+e.id}),ne=te.enter().append("div").attr("class","commit-msg").attr("id",function(e){return"msg-"+e.id}).style("top",function(e){var t=e;return H(t.orderNr)-s.rowHeight/2+"px"}).on("click",function(t){if("A"==d3.event.target.tagName)return!0;var n=[];if("SPAN"==d3.event.target.tagName&&d3.event.target.className.startsWith("label ")){u.log(o.DEBUG,d3.event.target.className);var r="refs/heads/"+d3.event.target.innerHTML;n.push(["Hide branch '"+d3.event.target.innerHTML+"'",function(){u.hiddenBranches.push(r),R()}])}"ancestry"==i.style&&n.push(["Stop highlighting",function(){i.style="none",i.root=null,e.updateHighlight()}]),"ancestry"===i.style&&t.id===i.root||n.push(["Highlight ancestry from here",function(){i.style="ancestry",i.root=t.id,e.updateHighlight()}]);var a=d3.mouse(X.node());m.show(n,a[0],a[1])}),re=ne.append("table").attr("class","commit-table aui").append("tr");ne.append("div").attr("class","bck");var ae=re.append("td").attr("class","msg");ae.append("span").attr("class","labels"),ae.append("span").attr("class","txt").text(function(e){return e.message});var ie=re.append("td").attr("class","author");ie.append("span").attr("class","aui-avatar aui-avatar-xsmall user-avatar").style("display",function(e){return e.author?"":"none"}).append("span").attr("class","aui-avatar-inner").append("img").attr("width","48px").attr("height","48px").attr("src",function(e){return e.author?u.createAuthorAvatarUrl(e.author):""}),ie.append("span").text(function(e){return e.author.displayName||e.author.name||e.author.emailAddress}),re.append("td").attr("class","date").attr("title",function(e){if(e.authorTimestamp){var t=new Date(e.authorTimestamp);return moment(t).format("dd YYYY-MM-DD")}}).text(function(e){if(e.authorTimestamp){var t=new Date(e.authorTimestamp),n=(new Date).toDateString()===t.toDateString();return n?moment(t).format("HH:mm:ss")+" today":moment(t).format("dd YYYY-MM-DD")}}),re.append("td").attr("class","sha").append("a").attr("class","commit-link").attr("href",function(e){return u.createCommitUrl(e)}).text(function(e){return e.displayId}),te.exit().remove();var se=te.select("table>tr>td.msg>span.labels");se.html(function(e){var t="";return _.each(e.labels||[],function(e){0==e.indexOf("refs/heads/")?t+=0==e.indexOf(u.masterRef)?"<span class='label aui-lozenge aui-lozenge-error aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf(u.developRef)?"<span class='label aui-lozenge aui-lozenge-success aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf(u.featurePrefix)?"<span class='label aui-lozenge aui-lozenge-complete aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf(u.releasePrefix)||0==e.indexOf(u.hotfixPrefix)?"<span class='label aui-lozenge aui-lozenge-current aui-lozenge-subtle'>"+e.substring(11)+"</span>":"<span class='label aui-lozenge aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf("refs/tags/")&&(t+="<span class='label aui-lozenge aui-lozenge-moved aui-lozenge-subtle'>"+e.substring(10)+"</span>")}),t}),te.transition().duration(800).style("top",function(e){var t=e;return H(t.orderNr)-s.rowHeight/2+"px"}),e.lazyLoad=function(){var e=null;for(var t in r.openEnds){if("asap"===t){e=t;break}var n=d3.select("#msg-"+t);if(!n.empty()&&f(n.node())){e=t;break}}if(e){var i="asap"===e?0:r.commits[e].orderNr;for(var t in r.openEnds){var s="asap"===t?0:r.commits[t].orderNr;if(!(s>i+200)){for(var c=0;c<r.openEnds[t].length;c++){var m=r.openEnds[t][c];O.indexOf(m)===-1&&(a[m]=!0,u.log(o.DEBUG,"scheduled: "+m))}delete r.openEnds[t]}}for(var t in a)u.log(o.DEBUG,"downloading: "+t),delete a[t],l[t]=!0,u.moreDataCallback(t,function(e,t){delete l[t],O.push(t),e&&k(e),0==Object.keys(a).length&&0==Object.keys(l).length?A.commits?(u.log(o.DEBUG,"queues empty, ready to draw"),setTimeout(function(){u.log(o.DEBUG,"start drawing"),R()},50)):u.log(o.DEBUG,"no new commits loaded, no need to redraw"):u.log(o.DEBUG,"waiting, still downloads in progress")});a={}}}};var a={},l={},c=function(e,t){var n=function(e){var t=r.commits[e];if(!t||0==r.columns.length)return"?";var n=t.columns.map(function(e){return r.columns[e]});return n[0].name[0]},a={m:0,d:1,r:3,f:2},i=[n(e),n(t)];return"d"===i[0]&&"d"!==i[1]?i[1]+" back":(i.sort(function(e,t){return a[t]-a[e]}),i[0]||"default")},m=function(){var e,t={},n=null,r=function(){(null===n||n.empty())&&(n=d3.select(".messages .context-menu"),n.on("mousemove",function(){a=Date.now()}))},a=0,i=function(){a=Date.now(),e=setInterval(function(){a+1e4<Date.now()&&t.hide()},100)},s=function(){clearInterval(e)};return t.show=function(e,a,s){r(),n.style("top",s+"px").style("left",a+"px").style("visibility","visible"),n.selectAll("div.item").remove(),_.each(e,function(e){n.append("div").on("click",function(){e[1](),t.hide()}).attr("class","item").text(e[0])}),d3.event.stopPropagation(),d3.select("body").on("click",function(){t.hide()}),i()},t.hide=function(){r(),n.style("visibility","hidden"),s()},t}();return e}();var T=null;return a.branches={setHidden:function(e){if(!(e instanceof Array))throw"pass in refs as an array of strings with full ref descriptors of the branches to hide (like 'refs/heads/develop')";u.hiddenBranches=e,R()},setChanged:function(e){D(e)&&(z(),a.drawing.lazyLoad())},getHidden:function(){return u.hiddenBranches},getAll:function(){return _.map(r.branches.concat(r.hiddenBranches),function(e){return{id:e.id,name:e.displayId,lastActivity:e.lastActivity,lastActivityFormatted:moment(e.lastActivity).format("M/D/YY HH:mm:ss"),visible:u.hiddenBranches.indexOf(e.id)===-1}})},registerHandler:function(e){T=e}},document&&(d3.select(document).on("scroll",function(){GitFlowVisualize.drawing.lazyLoad()}).on("resize",function(){GitFlowVisualize.drawing.lazyLoad()}),d3.select(document).on("keydown",function(){var e=d3.event;if(e.ctrlKey&&e.shiftKey&&221==e.which){var t=d3.select("#debug-output");t.empty()&&(t=d3.select("body").append("textarea").attr("id","debug-output")),t.style("display",""),t.node().value=GitFlowVisualize.state(),t.node().focus(),t.node().select(),t.on("blur",function(){t.style("display","none")})}})),a}();