"use strict";var GitFlowVisualize=function(){function e(e){var t=this;t.id=e,t.name=e,t.commits=[];var r=null,a=[];t.combine=function(e){r=e,e.receive(t)},t.receive=function(e){a.push(e)},t.isVisible=function(){return null===r},t.renderPos=function(){return r?r.id:t.id};var i=function(){return a.concat(t)},s=function(e){var t=n.commits[e];return t&&t.visible===!0};t.firstVisible=function(){var e=_.findLast(t.commits,s);return n.commits[e]},t.lastVisible=function(){var e=_.find(t.commits,s);return n.commits[e]},t.firstRenderedCommit=function(){return r?null:i().reduce(function(e,t){var n=t.firstVisible();return n&&(!e||e.orderNr<n.orderNr)?n:e},null)},t.lastRenderedCommit=function(){return r?null:i().reduce(function(e,t){var n=t.lastVisible();return!e||e.orderNr>n.orderNr?n:e},null)},t.finallyMergesToColumn=function(){var e=this.lastVisible();if(!e)return null;var t=e.children;return 0===t.length?null:n.columns[n.commits[t[0]].columns[0]]}}function t(e){var n={score:0},r=e.slice(0),a=r.length,i=r[a-1];n.members={};for(var s=null,o=0;o<r.length;o++)n.members[r[o]]=s,s=r[o];return n.push=function(e){var t=i;a++,n.members[e]=t,i=e,r.push(e)},n.last=function(){return i},n.clone=function(){var e=t(r);return e.score=n.score,e},n.asArray=function(){return r.slice(0)},n}var n,r={},a={style:"none",root:null},i={rowHeight:35},s=CryptoJS.MD5,o={drawElem:null,drawTable:!1,masterRef:"refs/heads/master",developRef:"refs/heads/develop",featurePrefix:"refs/heads/feature/",releasePrefix:"refs/heads/release/",hotfixPrefix:"refs/heads/hotfix/",releaseZonePattern:/^refs\/heads\/bugfix/,releaseTagPattern:/^refs\/tags\/\d+(\.\d+)+$/,showSpinner:function(){},hideSpinner:function(){},dataCallback:function(e){console.log("The required option 'dataCallback' is missing, please provide a method to retrieve commit data"),e({})},moreDataCallback:function(e,t){console.log("The required option 'moreDataCallback' is missing, please provide a method to retrieve commit data"),t({})},dataProcessed:function(){},createCommitUrl:function(){return"#"},createAuthorAvatarUrl:_.memoize(function(e){return"https://secure.gravatar.com/avatar/"+s(e.emailAddress)+".jpg?s=48&amp;d=mm"},function(e){return e.emailAddress}),hiddenBranches:[]},l=function(e){var t={};if(n=t,t.commits={},t.openEnds={},!e.commits||!e.branches||!e.tags)throw"raw data should have a commits, branches and  tags property";for(var a=0;a<e.commits.length;a++)for(var i=0;i<e.commits[a].values.length;i++){var s=e.commits[a].values[i];delete s.columns,delete s.labels,delete s.orderTimestamp,delete s.children,t.commits[s.id]=s}for(var l in t.commits){var s=t.commits[l];s.orderTimestamp=s.authorTimestamp,s.children||(s.children=[]);for(var a=s.parents.length-1;a>=0;a--){var d=t.commits[s.parents[a].id];d?c(d,s.id):(t.openEnds[s.id]=t.openEnds[s.id]||[],t.openEnds[s.id].push(s.parents[a].id))}}t.branches=_.filter(e.branches.values,function(e){return o.hiddenBranches.indexOf(e.id)===-1}),t.hiddenBranches=_.filter(e.branches.values,function(e){return o.hiddenBranches.indexOf(e.id)>-1});for(var a=0;a<t.branches.length;a++){var m=t.branches[a],s=t.commits[m.latestChangeset];s?(s.labels=s.labels||[],s.labels.push(m.id),m.lastActivity=s.authorTimestamp):(t.openEnds.asap=t.openEnds.asap||[],t.openEnds.asap.push(m.latestChangeset))}var f=function(e,n){if(e&&e.orderTimestamp<=n){e.orderTimestamp=n+1;for(var r=0;r<e.children.length;r++)f(t.commits[e.children[r]],e.orderTimestamp)}};for(var h in t.commits)for(var g=t.commits[h],p=0;p<g.parents.length;p++){var d=t.commits[g.parents[p].id];d&&f(g,d.orderTimestamp)}t.tags=e.tags.values;for(var a=0;a<t.tags.length;a++){var v=t.tags[a],s=t.commits[v.latestChangeset];s&&(s.labels=s.labels||[],s.labels.push(v.id))}t.labels=t.tags.concat(t.branches),t.chronoCommits=[];for(var l in t.commits)t.chronoCommits.push(l);t.chronoCommits.sort(function(e,n){return t.commits[n].orderTimestamp-t.commits[e].orderTimestamp}),t.visibleCommits=[];for(var b=0,a=0;a<t.chronoCommits.length;a++){var s=t.commits[t.chronoCommits[a]];if(s.labels&&s.labels.length)s.visible=!0;else{var y=_.filter(_.map(s.children,function(e){return t.commits[e]}),function(e){return e.visible});s.visible=y.length>0}s.visible?(s.orderNr=b,t.visibleCommits.push(t.chronoCommits[a]),b++):delete s.orderNr}return u(t),t.openEnds.asap&&setTimeout(function(){r.drawing.lazyLoad()},1),t},c=function(e,t){e.children=e.children||[],e.children.push(t)},u=function(){d(),m(),f(),h(),g("d"),g("f"),g("r")},d=function(){var e=_.filter(n.branches,function(e){return e.id==o.masterRef});if(0!=e.length){for(var t=v(e[0].latestChangeset,_.map(_.filter(n.tags,function(e){return e.id.match(o.releaseTagPattern)}),function(e){return e.latestChangeset}),n),r=0;r<t.length;r++)p(t[r],"m",n);for(;;){var a=n.columns.m.commits,i=a[a.length-1],s=n.commits[i].parents;if(!s||0==s.length)break;if(!p(s[0].id,"m",n))break}}},m=function(){var e=_.filter(n.branches,function(e){return e.id==o.developRef});if(0!=e.length){for(var t=y(e[0].latestChangeset),r=0;r<t.length;r++)p(t[r],"d0",n);for(var a=o.developRef.substring(o.developRef.lastIndexOf("/")+1),i=new RegExp("Merge branch '[^']+' (of \\S+ )?into "+a+"$"),s=1,r=0;r<n.chronoCommits.length;r++){var l=n.commits[n.chronoCommits[r]];l.columns||i.test(l.message)&&(p(l.id,"d"+s),s++)}}},f=function(){for(var e=0,t=0;t<n.chronoCommits.length;t++){var r=n.commits[n.chronoCommits[t]];if(!r.columns){var a=_.filter(r.children,function(e){var t=n.commits[e];if(t.columns&&("m"==t.columns[0]||"d"==t.columns[0][0]))return!1;n.columns[t.columns[0]]||console.log("huh");var r=n.columns[t.columns[0]].commits;return t.id==r[r.length-1]});if(0==a.length)p(r.id,"c"+e,n),e++;else{var i=n.commits[a[0]];i&&i.columns?(p(r.id,i.columns[0],n),i._hasColumnChild=!0):console.log("Couldn't find appropriate parent")}}}},h=function(){for(var e=0;e<n.branches.length;e++){var t=n.branches[e];if(0===t.id.indexOf(o.releasePrefix)||0===t.id.indexOf(o.hotfixPrefix)||0===t.id.match(o.releaseZonePattern)){var r=n.commits[t.latestChangeset];if(r){var a=n.columns[r.columns[0]];"c"===a.name[0]&&(a.name="r"+a.name.substring(1))}}}for(var e=0;e<n.branches.length;e++){var t=n.branches[e];if(0===t.id.indexOf(o.featurePrefix)){var r=n.commits[t.latestChangeset];if(r){var a=n.columns[r.columns[0]];"c"===a.name[0]&&(a.name="f"+a.name.substring(1))}}}for(var i in n.columns){var a=n.columns[i];if("m"!=i&&"d"!=i[0]&&"r"!=i[0]){var s=_.flatMap(a.commits,function(e){return n.commits[e].children});if(_.filter(s,function(e){var t=n.commits[e];return t.visible&&t.columns&&"m"==t.columns[0]}).length>0)a.name="r"+a.name.substring(1);else{var l=a.lastVisible();l&&(l.labels&&l.labels.filter(function(e){return 0==e.indexOf(o.releasePrefix)||0==e.indexOf(o.hotfixPrefix)||o.releaseZonePattern.test(e)}).length>0?a.name="r"+a.name.substring(1):l.labels&&l.labels.filter(function(e){return 0==e.indexOf(o.featurePrefix)}).length>0&&(a.name="f"+a.name.substring(1)))}}}for(;;){for(var c=!1,u=_.filter(_.map(Object.keys(n.columns),function(e){return n.columns[e]}),function(e){return"c"==e.name[0]}),d=0;d<u.length;d++){var a=u[d],m=a.finallyMergesToColumn(),f=m?m.name[0]:"f";"c"!=f&&("d"==f&&(f="f"),a.name=f+a.name.substring(1),c=!0)}if(!c)break}for(var h=_.filter(_.map(Object.keys(n.columns),function(e){return n.columns[e]}),function(e){return"f"==e.name[0]}),g=_.filter(h,function(e){return e.commits.length>9}),p=1,v=0;v<g.length;v++){var b=g[v];b.group=p,p++}for(var v=0;v<h.length;v++){var b=h[v],l=n.commits[b.commits[0]];if(l.children&&l.children.length>0){var y=n.columns[n.commits[l.children[0]].columns[0]];y.group&&(b.group=y.group)}else{var x=n.commits[b.commits[b.commits.length-1]];if(x.parents&&x.parents.length>0){var w=n.commits[x.parents[0].id];if(w){var C=n.columns[w.columns[0]];C.group&&(b.group=C.group)}}}}},g=function(e){for(var t=_.map(n.columns,function(e){return e}).filter(function(t){return t.name[0]==e}),r={},a=0;a<t.length;a++)t[a].group&&(r[t[a].group]=!0);r=Object.keys(r),r.unshift(null);for(var i=0;i<r.length;i++)for(var s=r[i],o=_.filter(t,function(e){return null===s?void 0===e.group:e.group==s}),a=0;a<o.length;a++)for(var l=o[a],c=0;c<a;c++){var u=o[c];if(u.isVisible()){var d=u.firstRenderedCommit();d&&d.parents.length>0&&n.commits[d.parents[0].id]&&(d=n.commits[d.parents[0].id]);var m=l.lastRenderedCommit();m&&m.children.length>0&&n.commits[m.children[0]]&&(m=n.commits[m.children[0]]),(!m||!d||m.orderNr>=d.orderNr)&&(l.combine(u),c=a)}}},p=function(t,r){n.columns||(n.columns={}),r in n.columns||(n.columns[r]=new e(r));var a=n.commits[t];return!!a&&(a.columns=a.columns||[],a.columns.push(r),n.columns[r].commits.push(t),!0)},v=function(e,t){return b(e,function(e,n){return t.indexOf(n)>-1?1e3:-1}).asArray()},b=function(e,r){var a=r||function(){return-1},i=[],s={},o=n.commits[e],l=t([e]),c=0;for(l.score=0,s[o.orderNr]=l,c=o.orderNr,i.push(l);i.length>0;)for(var u=i.shift(),d=n.commits[u.last()],m=0;m<d.parents.length;m++){var f=n.commits[d.parents[m].id];if(f){var h=a(u,f.id);if(h!==!1&&!(s[f.orderNr]&&s[f.orderNr].score>u.score+h)){var g=u.clone();g.push(f.id),g.score=u.score+h,i.push(g),s[f.orderNr]=g,c<f.orderNr&&(c=f.orderNr)}}}var p=Object.keys(s);return p.sort(function(e,t){return e&&t?s[t].score-s[e].score:0}),s[p[0]]},y=function(e){var t=o.developRef.substring(o.developRef.lastIndexOf("/")+1),r=o.releasePrefix.split("/")[2],a=o.hotfixPrefix.split("/")[2],i=new RegExp("Merge branch '("+t+")' of http:\\/\\/\\S+ into \\1"),s=new RegExp("Merge branch '[^']+' into "+t+"$"),l=new RegExp("Merge branch '("+r+"|"+a+")[^']+' into "+t+"\\b");return b(e,function(e,t){var r=n.commits[t],a=n.commits[e.last()];return(!r.columns||"m"!=r.columns[0])&&(1==r.children.filter(function(t){return t in e.members}).length&&(i.test(r.message)?0:l.test(r.message)?20:s.test(r.message)?5:a.parents.length>1&&r.id==a.parents[0].id?1:-.1))}).asArray()};r.state=function(){return JSON.stringify(x)};var x=null,w=[];r.draw=function(e,t){if(e)try{e instanceof HTMLElement||(t=e,e=null)}catch(n){"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument||(t=e,e=null)}o=_.extend(o,t),o.drawElem=o.drawElem||e,o.drawElem?o.drawElem instanceof d3.selection||(o.drawElem=d3.select(o.drawElem)):o.drawElem=d3.select("body").append("div").attr("id","gitflow-visualize"),o.showSpinner(),o.dataCallback(function(e){x=e,o.hideSpinner(),N()})};var C=function(e){x.commits.push(e)},A=function(e){var t=x.branches.values.reduce(function(e,t){return e[t.id]=t,e},{}),n=!1;return e.values.forEach(function(e){var r=e.id;r in t?t[r].latestChangeset!==e.latestChangeset&&(n=!0,t[r].latestChangeset=e.latestChangeset):(x.branches.values.push(e),n=!0)}),n},N=function(){o.showSpinner(),n=setTimeout(function(){l(x),o.hideSpinner(),o.dataProcessed(n),o.drawElem&&(r.drawing.drawTable(o.drawElem),r.drawing.drawGraph(o.drawElem),r.drawing.updateHighlight())},10)};r.drawing=function(){var e={};e.updateHighlight=function(){var e=function(e){if(!e||0==e.length)return d3.selectAll(".commit-msg").classed("dim",!1).classed("highlight",!1),d3.selectAll(".commit-dot").classed("dim",!1),void d3.selectAll(".arrow").style("opacity","1");for(var t in n.commits)e.indexOf(t)>-1?(d3.selectAll("#msg-"+t).classed("dim",!1).classed("highlight",!0),d3.selectAll("#commit-"+t).classed("dim",!1),d3.selectAll(".arrow-to-"+t).style("opacity","1")):(d3.selectAll("#msg-"+t).classed("dim",!0).classed("highlight",!1),d3.selectAll("#commit-"+t).classed("dim",!0),d3.selectAll(".arrow-to-"+t).style("opacity","0.2"))};switch(d3.selectAll(".commit-msg.selected").classed("selected",!1),a.style){case"none":e([]);break;case"ancestry":var t=d3.select("#msg-"+a.root),r={},i=function(e){var t=n.commits[e];if(t&&!r[e]){r[e]=!0;for(var a=0;a<t.parents.length;a++)i(t.parents[a].id)}};t.classed("selected",!0),i(a.root),e(Object.keys(r))}},e.drawTable=function(e){if(o.drawTable){var r=d3.select(document.createElement("table"));r.append("tr").html(l()+"<td>sha</td><td>parent</td><td>author</td><td>at</td><td>msg</td></tr>");for(var a=0;a<n.chronoCommits.length;a++){var i=n.commits[n.chronoCommits[a]],c=new Date(i.authorTimestamp);r.append("tr").html(s(i)+"<td>"+i.displayId+"</td><td>"+t(i.parents)+"</td><td>"+i.author.name+"</td><td>"+moment(c).format("M/D/YY HH:mm:ss")+"</td><td>"+i.message+"</td>")}d3.select(e).append(r)}};var t=function(e){return _.map(e,function(e){return e.displayId}).join(", ")},r=function(e){var t=_.map(e,function(e,t){return t});return t.sort(firstBy(function(t,n){var r=function(t){return{m:1,d:3,f:4,r:2}[e[t].name[0]]||5};return r(t)-r(n)}).thenBy(function(e,t){return(n.columns[e].group||0)-(n.columns[t].group||0)}).thenBy(function(e,t){if("f"==n.columns[e].name[0]){var r=n.columns[e].commits,a=n.columns[t].commits;return n.commits[r[0]].orderNr-n.commits[a[0]].orderNr}return t>e?-1:1})),t},s=function(e){for(var t="",a=r(n.columns),i=0;i<a.length;i++){var s=a[i];t+="<td>",e.columns.indexOf(s)>-1&&(t+="o"),t+="</td>"}return t},l=function(){for(var e="",t=r(n.columns),a=0;a<t.length;a++){var i=t[a];e+="<td>"+n.columns[i].name+"</td>"}return e},c=function(e,t){for(var r={gutter:.7,line:1,developLine:.4},a={},i="",s=0,o={},l=0;l<e.length;l++){var c=e[l],u=n.columns[c];if(u.isVisible()){var d=c[0];i!=d&&(s+=r.gutter),s+="d"==d?r.developLine:r.line,o[c]=s,i=d}else a[c]=u.renderPos()}var m=d3.scale.linear().domain([0,s]).range([0,Math.min(t,20*s)]);return function(e){e in a&&(e=a[e]);var t=0;return"+"==e[e.length-1]&&(e=e.substring(0,e.length-1),t=.5),m(o[e]+t)}};e.drawGraph=function(t){function s(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}var l=Math.max(800,n.visibleCommits.length*i.rowHeight),h={width:500,height:l},g=t.select("svg>g");if(g.empty()){var p=t.append("div");p.attr("class","commits-graph-container");var g=p.append("svg").attr("class","commits-graph").append("g").attr("transform","translate(20,0)"),v=g.append("g").attr("id","bgLayer"),b=g.append("g").attr("id","arrowsLayer"),y=g.append("g").attr("id","mainLinesLayer"),x=g.append("g").attr("id","commitsLayer")}t.select("svg").attr("width",h.width+40).attr("height",h.height+40),v=g.select("g#bgLayer"),b=g.select("g#arrowsLayer"),y=g.select("g#mainLinesLayer"),x=g.select("g#commitsLayer");var A=r(n.columns),E={master:{prefix:"m"},releases:{prefix:"r"},develop:{prefix:"d"},features:{prefix:"f"}};for(var O in E){var k=A.filter(function(e){return n.columns[e].name[0]===E[O].prefix});0!=k.length?(E[O].first=k[0],E[O].last=k[k.length-1]):delete E[O]}var T=c(A,h.width,n.columnMappings),H=d3.scale.linear().domain([0,n.visibleCommits.length]).range([60,60+n.visibleCommits.length*i.rowHeight]),P=d3.svg.line().x(function(e){return T(e.x)}).y(function(e){return H(e.y)}),L=function(e){var t=n.commits[e.c],r=n.commits[e.p];if(!t||!r||!t.visible)return null;var a=r.orderNr-.5,i=t.columns[0],s=null,o=null,l=n.columns[t.columns[0]];if(!l)return null;var c=n.columns[r.columns[0]];if(l.id!=c.id){var u=c.commits[c.commits.indexOf(r.id)-1];if(!u||n.commits[u].orderNr<t.orderNr)a=t.orderNr+.5,i=r.columns[0];else{var d=l.commits[l.commits.indexOf(t.id)+1];!d||n.commits[d].orderNr>r.orderNr||(o=t.columns[0]+"+",s=r.orderNr-.5,i=t.columns[0]+"+",a=t.orderNr+.5)}}return o||(o=i),s||(s=a),P([{x:t.columns[0],y:t.orderNr},{x:i,y:a},{x:o,y:s},{x:r.columns[0],y:r.orderNr}])},M=_.flatMap(d3.values(n.commits).filter(function(e){return e.visible}),function(e){return e.parents.map(function(t){return{p:t.id,c:e.id}})}),D=b.selectAll(".arrow").data(M,function(e){return"a-"+e.p+"-"+e.c}),R=D.enter().append("g").attr("class",function(e){return"arrow arrow-to-"+e.c});R.append("path").attr("stroke-linejoin","round").attr("class","outline"),R.append("path").attr("stroke-linejoin","round").attr("class",function(e){return"branch-type-"+m(e.c,e.p)}),D.selectAll("g>path").transition().attr("d",L),D.exit().remove();var B=v.selectAll(".branch").data(d3.values(n.columns).filter(function(e){return e.isVisible()}));B.enter().append("g").attr("class","branch").append("line"),B.select("g>line").transition().attr("class",function(e){return"branch-line "+e.name}).attr("x1",function(e){return T(e.id)}).attr("x2",function(e){return T(e.id)}).attr("y1",H(0)).attr("y2",h.height),B.exit().remove();var B=y.selectAll(".branch").data(d3.values(n.columns).filter(function(e){return e.isVisible()&&("d0"===e.id||"m"===e.id)}));B.enter().append("g").attr("class","branch").append("line"),B.select("g>line").transition().attr("class",function(e){return"branch-line "+e.name}).attr("x1",function(e){return T(e.id)}).attr("x2",function(e){return T(e.id)}).attr("y1",H(0)).attr("y2",h.height);var j=x.selectAll(".commit").data(d3.values(n.commits).filter(function(e){return e.visible}),function(e){return"c-"+e.id});j.enter().append("g").attr("class","commit").append("circle").attr("class","commit-dot").attr("r",5),j.exit().remove(),j.transition().select("g>circle").attr("cx",function(e){return T(e.columns[0])}).attr("cy",function(e){return H(e.orderNr)}).attr("id",function(e){return"commit-"+e.id});var S=v.selectAll(".legenda-label").data(Object.keys(E)),V=S.enter(),Y=V.append("g").attr("class",function(e){return"legenda-label "+E[e].prefix}).append("g").attr("transform",function(e){var t=E[e].first==E[e].last?-10:0;return"translate("+(T(E[e].first)+t)+", "+(H(0)-20)+") rotate(-40)"});Y.append("rect").attr("width",60).attr("height",15).attr("rx","2"),Y.append("text").attr("y","12").attr("x","3").text(function(e){return e}),S.select("g").transition().attr("transform",function(e){var t=E[e].first==E[e].last?-10:0;return"translate("+(T(E[e].first)+t)+", "+(H(0)-20)+") rotate(-40)"});var I=t.select("div.messages");I.empty()&&(I=t.append("div").attr("class","messages"),I.append("div").attr("class","context-menu"));var G=t.select("div.gutter");if(G.empty()){G=t.append("div").attr("class","gutter");var F=!1,U=0,X=null;G.on("mousedown",function(){return F=!0,U=d3.event.pageX,X=G.offsetLeft-8,!1}),d3.select("body").on("mouseup",function(){if(F){var e=d3.event.pageX-U;console.log(e,d3.event.offsetX)}F=!1}),d3.select("body").on("mousemove",function(){if(F){var e=d3.event.pageX-U;G.style("left",e+X+"px")}})}var q=I.select("div.msg-header");q.empty()&&(q=I.append("div").attr("class","msg-header"),q.append("span").attr("class","branch-btn label aui-lozenge aui-lozenge-subtle").on("click",function(){var e=[["Show all",function(){o.hiddenBranches=[],N()}]];null!==z&&e.push(["Change...",z]);var t=d3.mouse(I.node());f.show(e,t[0],t[1])}));var Z=n.branches.length+n.hiddenBranches.length+" branches";n.hiddenBranches.length>0&&(Z+=" ("+n.hiddenBranches.length+" hidden)"),q.select("span.branch-btn").text(Z);var $=I.selectAll(".commit-msg").data(d3.values(n.commits).filter(function(e){return e.visible}),function(e){return e.id+"-"+e.orderNr});$.enter().append("div").attr("class","commit-msg").attr("id",function(e){return"msg-"+e.id}).on("click",function(t){if("A"==d3.event.target.tagName)return!0;var n=[];if("SPAN"==d3.event.target.tagName){var r="refs/heads/"+d3.event.target.innerHTML;n.push(["Hide branch '"+d3.event.target.innerHTML+"'",function(){o.hiddenBranches.push(r),N()}])}"ancestry"==a.style&&n.push(["Stop highlighting",function(){a.style="none",a.root=null,e.updateHighlight()}]),"ancestry"===a.style&&t.id===a.root||n.push(["Highlight ancestry from here",function(){a.style="ancestry",a.root=t.id,e.updateHighlight()}]);var i=d3.mouse(I.node());f.show(n,i[0],i[1])}),$.exit().remove(),$.html(function(e){var t=o.createCommitUrl(e),n="<table class='commit-table aui'><tr><td class='msg'>";if(e.labels&&_.each(e.labels,function(e){n+=0==e.indexOf("refs/heads/")?0==e.indexOf(o.masterRef)?"<span class='label aui-lozenge aui-lozenge-error aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf(o.developRef)?"<span class='label aui-lozenge aui-lozenge-success aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf(o.featurePrefix)?"<span class='label aui-lozenge aui-lozenge-complete aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf(o.releasePrefix)||0==e.indexOf(o.hotfixPrefix)?"<span class='label aui-lozenge aui-lozenge-current aui-lozenge-subtle'>"+e.substring(11)+"</span>":"<span class='label aui-lozenge aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf("refs/tags/")?"<span class='label aui-lozenge aui-lozenge-moved aui-lozenge-subtle'>"+e.substring(10)+"</span>":"<span class='label aui-lozenge aui-lozenge-subtle'>"+e+"</span>"}),n+=" "+e.message,n+="</td>",e.author){n+="<td class='author'><span class='aui-avatar aui-avatar-xsmall user-avatar'><span class='aui-avatar-inner'><img src='"+o.createAuthorAvatarUrl(e.author)+"' width='48px' height='48px' /></span></span>"+(e.author.displayName||e.author.name||e.author.emailAddress)+"</td>"}else n+="<td class='author'> </td>";if(e.authorTimestamp){var r=new Date(e.authorTimestamp);n+=(new Date).toDateString()===r.toDateString()?"<td class='date'>"+moment(r).format("HH:mm:ss")+" today</td> ":"<td class='date' title='"+moment(r).format("dddd YYYY-MM-DD HH:mm:ss")+"'>"+moment(r).format("dd YYYY-MM-DD")+"</td> "}return n+="<td class='sha'><a class='commit-link' href='"+t+"' target='_blank'>"+e.displayId+"</a></td> ",n+="</tr></table>"}).transition().attr("style",function(e){return"top:"+(H(e.orderNr)-i.rowHeight/2)+"px;"}),e.lazyLoad=function(){var e=null;for(var t in n.openEnds){if("asap"===t){e=t;break}var r=d3.select("#msg-"+t);if(!r.empty()&&s(r.node())){e=t;break}}if(e){var a="asap"===e?0:n.commits[e].orderNr;for(var t in n.openEnds){if(!(("asap"===t?0:n.commits[t].orderNr)>a+200)){for(var i=0;i<n.openEnds[t].length;i++){var l=n.openEnds[t][i];w.indexOf(l)===-1&&(u[l]=!0,console.log("scheduled: "+l))}delete n.openEnds[t]}}for(var t in u)console.log("downloading: "+t),delete u[t],d[t]=!0,o.moreDataCallback(t,function(e,t){delete d[t],w.push(t),e&&C(e),0==Object.keys(u).length&&0==Object.keys(d).length?(console.log("queues empty, ready to draw"),setTimeout(function(){console.log("start drawing"),N()},50)):console.log("waiting, still downloads in progress")});u={}}}};var u={},d={},m=function(e,t){var r=function(e){var t=n.commits[e];return t&&0!=n.columns.length?t.columns.map(function(e){return n.columns[e]})[0].name[0]:"?"},a={m:0,d:1,r:3,f:2},i=[r(e),r(t)];return"d"===i[0]&&"d"!==i[1]?i[1]+" back":(i.sort(function(e,t){return a[t]-a[e]}),i[0]||"default")},f=function(){var e,t={},n=null,r=function(){(null===n||n.empty())&&(n=d3.select(".messages .context-menu"),n.on("mousemove",function(){console.log("mouse move"),a=Date.now()}))},a=0,i=function(){a=Date.now(),e=setInterval(function(){a+1e4<Date.now()&&t.hide()},100)},s=function(){clearInterval(e)};return t.show=function(e,a,s){r(),n.style("top",s+"px").style("left",a+"px").style("visibility","visible"),n.selectAll("div.item").remove(),_.each(e,function(e){n.append("div").on("click",function(){e[1](),t.hide()}).attr("class","item").text(e[0])}),d3.event.stopPropagation(),d3.select("body").on("click",function(){t.hide()}),i()},t.hide=function(){r(),n.style("visibility","hidden"),s()},t}();return e}();var z=null;return r.branches={setHidden:function(e){if(!(e instanceof Array))throw"pass in refs as an array of strings with full ref descriptors of the branches to hide (like 'refs/heads/develop')";o.hiddenBranches=e,N()},setChanged:function(e){A(e)&&(N(),r.drawing.lazyLoad())},getHidden:function(){return o.hiddenBranches},getAll:function(){return _.map(n.branches.concat(n.hiddenBranches),function(e){return{id:e.id,name:e.displayId,lastActivity:e.lastActivity,lastActivityFormatted:moment(e.lastActivity).format("M/D/YY HH:mm:ss"),visible:o.hiddenBranches.indexOf(e.id)===-1}})},registerHandler:function(e){z=e}},document&&(d3.select(document).on("scroll",function(){GitFlowVisualize.drawing.lazyLoad()}).on("resize",function(){GitFlowVisualize.drawing.lazyLoad()}),d3.select(document).on("keydown",function(){var e=d3.event;if(e.ctrlKey&&e.shiftKey&&221==e.which){var t=d3.select("#debug-output");t.empty()&&(t=d3.select("body").append("textarea").attr("id","debug-output")),t.style("display",""),t.node().value=GitFlowVisualize.state(),t.node().focus(),t.node().select(),t.on("blur",function(){t.style("display","none")})}})),r}();