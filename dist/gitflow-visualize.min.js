"use strict";var GitFlowVisualize=function(){function e(e){var t=this;t.id=e,t.name=e,t.commits=[];var n=null,i=[];t.combine=function(e){n=e,e.receive(t)},t.receive=function(e){i.push(e)},t.isVisible=function(){return null===n},t.renderPos=function(){return n?n.id:t.id};var a=function(){return i.concat(t)},s=function(e){var t=r.commits[e];return t&&t.visible===!0};t.firstVisible=function(){var e=_.findLast(t.commits,s);return r.commits[e]},t.lastVisible=function(){var e=_.find(t.commits,s);return r.commits[e]},t.firstRenderedCommit=function(){if(n)return null;var e=a();return e.reduce(function(e,t){var r=t.firstVisible();return r&&(!e||e.orderNr<r.orderNr)?r:e},null)},t.lastRenderedCommit=function(){if(n)return null;var e=a();return e.reduce(function(e,t){var r=t.lastVisible();return!e||e.orderNr>r.orderNr?r:e},null)}}function t(e){var r={score:0},n=e.slice(0),i=n.length,a=n[i-1];r.members={};for(var s=null,o=0;o<n.length;o++)r.members[n[o]]=s,s=n[o];return r.push=function(e){var t=a;i++,r.members[e]=t,a=e,n.push(e)},r.last=function(){return a},r.clone=function(){var e=t(n);return e.score=r.score,e},r.asArray=function(){return n.slice(0)},r}var r,n={},i={style:"none",root:null},a={rowHeight:35},s=CryptoJS.MD5,o={drawElem:null,drawTable:!1,masterRef:"refs/heads/master",developRef:"refs/heads/develop",featurePrefix:"refs/heads/feature/",releasePrefix:"refs/heads/release/",hotfixPrefix:"refs/heads/hotfix/",releaseZonePattern:/^refs\/heads\/bugfix/,releaseTagPattern:/refs\/tags\/\d+(\.\d+)+$/,showSpinner:function(){},hideSpinner:function(){},dataCallback:function(e){console.log("The required option 'dataCallback' is missing, please provide a method to retrieve commit data"),e({})},moreDataCallback:function(e,t){console.log("The required option 'moreDataCallback' is missing, please provide a method to retrieve commit data"),t({})},dataProcessed:function(){},createCommitUrl:function(){return"#"},createAuthorAvatarUrl:function(e){return"https://secure.gravatar.com/avatar/"+s(e.emailAddress)+".jpg?s=48&amp;d=mm"},hiddenBranches:[]},l=function(e){var t={};if(r=t,t.commits={},t.openEnds={},!e.commits||!e.branches||!e.tags)throw"raw data should have a commits, branches and  tags property";for(var n=0;n<e.commits.length;n++)for(var i=0;i<e.commits[n].values.length;i++){var a=e.commits[n].values[i];delete a.columns,delete a.labels,delete a.orderTimestamp,delete a.children,t.commits[a.id]=a}for(var s in t.commits){var a=t.commits[s];a.orderTimestamp=a.authorTimestamp,a.children||(a.children=[]);for(var n=a.parents.length-1;n>=0;n--){var l=t.commits[a.parents[n].id];l?c(l,a.id):(t.openEnds[a.id]=t.openEnds[a.id]||[],t.openEnds[a.id].push(a.parents[n].id))}}t.branches=_.filter(e.branches.values,function(e){return o.hiddenBranches.indexOf(e.id)===-1}),t.hiddenBranches=_.filter(e.branches.values,function(e){return o.hiddenBranches.indexOf(e.id)>-1});for(var n=0;n<t.branches.length;n++){var u=t.branches[n],a=t.commits[u.latestChangeset];a&&(a.labels=a.labels||[],a.labels.push(u.id),u.lastActivity=a.authorTimestamp)}var d=function(e,r){if(e&&e.orderTimestamp<=r){e.orderTimestamp=r+1;for(var n=0;n<e.children.length;n++)d(t.commits[e.children[n]],e.orderTimestamp)}};for(var f in t.commits)for(var h=t.commits[f],g=0;g<h.parents.length;g++){var l=t.commits[h.parents[g].id];l&&d(h,l.orderTimestamp)}t.tags=e.tags.values;for(var n=0;n<t.tags.length;n++){var p=t.tags[n],a=t.commits[p.latestChangeset];a&&(a.labels=a.labels||[],a.labels.push(p.id))}t.labels=t.tags.concat(t.branches),t.chronoCommits=[];for(var s in t.commits)t.chronoCommits.push(s);for(var n=0;n<t.chronoCommits.length;n++){var a=t.commits[t.chronoCommits[n]];if(a.labels&&a.labels.length)a.visible=!0;else{var v=_.filter(_.map(a.children,function(e){return t.commits[e]}),function(e){return e.visible});a.visible=v.length>0}}t.chronoCommits.sort(function(e,r){return t.commits[r].orderTimestamp-t.commits[e].orderTimestamp}),t.visibleCommits=[];for(var n=0,b=0;n<t.chronoCommits.length;n++){var a=t.commits[t.chronoCommits[n]];a.visible?(a.orderNr=b,t.visibleCommits.push(t.chronoCommits[n]),b++):delete a.orderNr}return m(t),t},c=function(e,t){e.children=e.children||[],e.children.push(t)},m=function(){u(),d(),f(),h(),g("d"),g("f"),g("r")},u=function(){var e=_.filter(r.branches,function(e){return e.id==o.masterRef});if(0!=e.length){for(var t=v(e[0].latestChangeset,_.map(_.filter(r.tags,function(e){return e.id.match(o.releaseTagPattern)}),function(e){return e.latestChangeset}),r),n=0;n<t.length;n++)p(t[n],"m",r);for(;;){var i=r.columns.m.commits,a=i[i.length-1],s=r.commits[a].parents;if(!s||0==s.length)break;if(!p(s[0].id,"m",r))break}}},d=function(){var e=_.filter(r.branches,function(e){return e.id==o.developRef});if(0!=e.length){for(var t=y(e[0].latestChangeset),n=0;n<t.length;n++)p(t[n],"d0",r);for(var i=o.developRef.substring(o.developRef.lastIndexOf("/")+1),a=new RegExp("Merge branch '[^']+' (of \\S+ )?into "+i+"$"),s=1,n=0;n<r.chronoCommits.length;n++){var l=r.commits[r.chronoCommits[n]];l.columns||a.test(l.message)&&(p(l.id,"d"+s),s++)}}},f=function(){for(var e=0,t=0;t<r.chronoCommits.length;t++){var n=r.commits[r.chronoCommits[t]];if(!n.columns){var i=_.filter(n.children,function(e){var t=r.commits[e],n=t.columns&&("m"==t.columns[0]||"d"==t.columns[0][0]);if(n)return!1;r.columns[t.columns[0]]||console.log("huh");var i=r.columns[t.columns[0]].commits;return t.id==i[i.length-1]});if(0==i.length)p(n.id,"c"+e,r),e++;else{var a=r.commits[i[0]];a&&a.columns?(p(n.id,a.columns[0],r),a._hasColumnChild=!0):console.log("Couldn't find appropriate parent")}}}},h=function(){for(var e in r.columns){var t=r.columns[e];if("m"!=e&&"d"!=e[0]){var n=_.flatMap(t.commits,function(e){return r.commits[e].children}),i=_.filter(n,function(e){var t=r.commits[e];return t.columns&&"m"==t.columns[0]});if(i.length>0)t.name="r"+t.name.substring(1);else{var a=r.commits[t.commits[0]];if(a.children.length>0){var s=_.filter(a.children,function(e){return"d"==r.commits[e].columns[0][0]});s.length>0?t.name="f"+t.name.substring(1):t.firstChild=r.commits[a.children[0]]}else a.labels&&a.labels.filter(function(e){return 0==e.indexOf(o.featurePrefix)}).length>0&&(t.name="f"+t.name.substring(1)),a.labels&&a.labels.filter(function(e){return 0==e.indexOf(o.releasePrefix)||0==e.indexOf(o.hotfixPrefix)||o.releaseZonePattern.test(e)}).length>0?t.name="r"+t.name.substring(1):t.name="f"+t.name.substring(1)}}}for(var l=_.filter(_.map(Object.keys(r.columns),function(e){return r.columns[e]}),function(e){return"c"==e.name[0]});;){for(var c=!1,m=0;m<l.length;m++){var t=l[m];if(t.firstChild){var u=r.columns[t.firstChild.columns[0]],d=u.name[0];"c"!=d&&(t.name=d+t.name.substring(1),delete t.firstChild,c=!0)}}if(!c)break}for(var f=_.filter(_.map(Object.keys(r.columns),function(e){return r.columns[e]}),function(e){return"f"==e.name[0]}),h=_.filter(f,function(e){return e.commits.length>9}),g=1,p=0;p<h.length;p++){var v=h[p];v.group=g,g++}for(var p=0;p<f.length;p++){var v=f[p],a=r.commits[v.commits[0]];if(a.children&&a.children.length>0){var b=r.columns[r.commits[a.children[0]].columns[0]];b.group&&(v.group=b.group)}else{var y=r.commits[v.commits[v.commits.length-1]];if(y.parents&&y.parents.length>0){var x=r.commits[y.parents[0].id];if(x){var w=r.columns[x.columns[0]];w.group&&(v.group=w.group)}}}}},g=function(e){for(var t=_.map(r.columns,function(e){return e}).filter(function(t){return t.name[0]==e}),n={},i=0;i<t.length;i++)t[i].group&&(n[t[i].group]=!0);n=Object.keys(n),n.unshift(null);for(var i=0;i<n.length;i++)for(var a=n[i],s=_.filter(t,function(e){return null===a?"undefined"==typeof e.group:e.group==a}),i=0;i<s.length;i++)for(var o=s[i],l=0;l<i;l++){var c=s[l];if(c.isVisible()){var m=c.firstRenderedCommit();m&&m.parents.length>0&&r.commits[m.parents[0].id]&&(m=r.commits[m.parents[0].id]);var u=o.lastRenderedCommit();u&&u.children.length>0&&r.commits[u.children[0]]&&(u=r.commits[u.children[0]]),(!u||!m||u.orderNr>=m.orderNr)&&(o.combine(c),l=i)}}},p=function(t,n){r.columns||(r.columns={}),n in r.columns||(r.columns[n]=new e(n));var i=r.commits[t];return!!i&&(i.columns=i.columns||[],i.columns.push(n),r.columns[n].commits.push(t),!0)},v=function(e,t){var r=function(e,r){return t.indexOf(r)>-1?1e3:-1},n=b(e,r);return n.asArray()},b=function(e,n){var i=n||function(){return-1},a=[],s={},o=r.commits[e],l=t([e]),c=0;for(l.score=0,s[o.orderNr]=l,c=o.orderNr,a.push(l);a.length>0;)for(var m=a.shift(),u=r.commits[m.last()],d=0;d<u.parents.length;d++){var f=r.commits[u.parents[d].id];if(f){var h=i(m,f.id);if(h!==!1&&!(s[f.orderNr]&&s[f.orderNr].score>m.score+h)){var g=m.clone();g.push(f.id),g.score=m.score+h,a.push(g),s[f.orderNr]=g,c<f.orderNr&&(c=f.orderNr)}}}var p=Object.keys(s);return p.sort(function(e,t){return e&&t?s[t].score-s[e].score:0}),s[p[0]]},y=function(e){var t=o.developRef.substring(o.developRef.lastIndexOf("/")+1),n=o.releasePrefix.split("/")[2],i=o.hotfixPrefix.split("/")[2],a=new RegExp("Merge branch '("+t+")' of http:\\/\\/\\S+ into \\1"),s=new RegExp("Merge branch '[^']+' into "+t+"$"),l=new RegExp("Merge branch '("+n+"|"+i+")[^']+' into "+t+"\\b"),c=function(e,t){var n=r.commits[t],i=r.commits[e.last()];if(n.columns&&"m"==n.columns[0])return!1;var o=n.children.filter(function(t){return t in e.members});return 1==o.length&&(a.test(n.message)?0:l.test(n.message)?20:s.test(n.message)?5:i.parents.length>1&&n.id==i.parents[0].id?1:-.1)},m=b(e,c);return m.asArray()};n.state=function(){var e=JSON.stringify(x);return e};var x=null;n.draw=function(e,t){if(e)try{e instanceof HTMLElement||(t=e,e=null)}catch(r){"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument||(t=e,e=null)}o=_.extend(o,t),o.drawElem=o.drawElem||e,o.drawElem?o.drawElem instanceof d3.selection||(o.drawElem=d3.select(o.drawElem)):o.drawElem=d3.select("body").append("div").attr("id","gitflow-visualize"),o.showSpinner(),o.dataCallback(function(e){x=e,o.hideSpinner(),C()})};var w=function(e){x.commits.push(e)},C=function(){o.showSpinner(),r=setTimeout(function(){l(x),o.hideSpinner(),o.dataProcessed(r),o.drawElem&&(n.drawing.drawTable(o.drawElem),n.drawing.drawGraph(o.drawElem),n.drawing.updateHighlight())},10)};return n.drawing=function(){var e={};e.updateHighlight=function(){var e=function(e){if(!e||0==e.length)return d3.selectAll(".commit-msg").classed("dim",!1).classed("highlight",!1),d3.selectAll(".commit-dot").classed("dim",!1),void d3.selectAll(".arrow").style("opacity","1");for(var t in r.commits)e.indexOf(t)>-1?(d3.selectAll("#msg-"+t).classed("dim",!1).classed("highlight",!0),d3.selectAll("#commit-"+t).classed("dim",!1),d3.selectAll(".arrow-to-"+t).style("opacity","1")):(d3.selectAll("#msg-"+t).classed("dim",!0).classed("highlight",!1),d3.selectAll("#commit-"+t).classed("dim",!0),d3.selectAll(".arrow-to-"+t).style("opacity","0.2"))};switch(d3.selectAll(".commit-msg.selected").classed("selected",!1),i.style){case"none":e([]);break;case"ancestry":var t=d3.select("#msg-"+i.root),n={},a=function(e){var t=r.commits[e];if(t&&!n[e]){n[e]=!0;for(var i=0;i<t.parents.length;i++)a(t.parents[i].id)}};t.classed("selected",!0),a(i.root),e(Object.keys(n))}},e.drawTable=function(e){if(o.drawTable){var n=d3.select(document.createElement("table"));n.append("tr").html(l()+"<td>sha</td><td>parent</td><td>author</td><td>at</td><td>msg</td></tr>");for(var i=0;i<r.chronoCommits.length;i++){var a=r.commits[r.chronoCommits[i]],c=new Date(a.authorTimestamp);n.append("tr").html(s(a)+"<td>"+a.displayId+"</td><td>"+t(a.parents)+"</td><td>"+a.author.name+"</td><td>"+moment(c).format("M/D/YY HH:mm:ss")+"</td><td>"+a.message+"</td>")}d3.select(e).append(n)}};var t=function(e){return _.map(e,function(e){return e.displayId}).join(", ")},n=function(e){var t=_.map(e,function(e,t){return t});return t.sort(firstBy(function(t,r){var n=function(t){return{m:1,d:3,f:4,r:2}[e[t].name[0]]||5};return n(t)-n(r)}).thenBy(function(e,t){return(r.columns[e].group||0)-(r.columns[t].group||0)}).thenBy(function(e,t){if("f"==r.columns[e].name[0]){var n=r.columns[e].commits,i=r.columns[t].commits;return r.commits[n[0]].orderNr-r.commits[i[0]].orderNr}return t>e?-1:1})),t},s=function(e){for(var t="",i=n(r.columns),a=0;a<i.length;a++){var s=i[a];t+="<td>",e.columns.indexOf(s)>-1&&(t+="o"),t+="</td>"}return t},l=function(){for(var e="",t=n(r.columns),i=0;i<t.length;i++){var a=t[i];e+="<td>"+r.columns[a].name+"</td>"}return e},c=function(e,t){for(var n={gutter:.7,line:1,developLine:.4},i={},a="",s=0,o={},l=0;l<e.length;l++){var c=e[l],m=r.columns[c];if(m.isVisible()){var u=c[0];a!=u&&(s+=n.gutter),s+="d"==u?n.developLine:n.line,o[c]=s,a=u}else i[c]=m.renderPos()}var d=d3.scale.linear().domain([0,s]).range([0,Math.min(t,20*s)]);return function(e){e in i&&(e=i[e]);var t=0;return"+"==e[e.length-1]&&(e=e.substring(0,e.length-1),t=.5),d(o[e]+t)}};e.drawGraph=function(t){function s(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}var l=Math.max(800,r.visibleCommits.length*a.rowHeight),h={width:500,height:l},g=20,p=t.select("svg>g");if(p.empty()){var v=t.append("div");v.attr("class","commits-graph-container");var p=v.append("svg").attr("class","commits-graph").append("g").attr("transform","translate("+g+",0)")}t.select("svg").attr("width",h.width+2*g).attr("height",h.height+2*g);var b=n(r.columns),y={master:{prefix:"m"},releases:{prefix:"r"},develop:{prefix:"d"},features:{prefix:"f"}};for(var x in y){var N=b.filter(function(e){return r.columns[e].name[0]===y[x].prefix});0!=N.length?(y[x].first=N[0],y[x].last=N[N.length-1]):delete y[x]}var A=c(b,h.width,r.columnMappings),k=d3.scale.linear().domain([0,r.visibleCommits.length]).range([60,60+r.visibleCommits.length*a.rowHeight]),z=d3.svg.line().x(function(e){return A(e.x)}).y(function(e){return k(e.y)}),E=function(e){var t=r.commits[e.c],n=r.commits[e.p];if(!t||!n||!t.visible)return null;var i=n.orderNr-.5,a=t.columns[0],s=null,o=null,l=r.columns[t.columns[0]];if(!l)return null;var c=r.columns[n.columns[0]];if(l.id!=c.id){var m=c.commits[c.commits.indexOf(n.id)-1];if(!m||r.commits[m].orderNr<t.orderNr)i=t.orderNr+.5,a=n.columns[0];else{var u=l.commits[l.commits.indexOf(t.id)+1];!u||r.commits[u].orderNr>n.orderNr||(o=t.columns[0]+"+",s=n.orderNr-.5,a=t.columns[0]+"+",i=t.orderNr+.5)}}o||(o=a),s||(s=i);var d=[{x:t.columns[0],y:t.orderNr},{x:a,y:i},{x:o,y:s},{x:n.columns[0],y:n.orderNr}];return z(d)},O=_.flatMap(d3.values(r.commits).filter(function(e){return e.visible}),function(e){return e.parents.map(function(t){return{p:t.id,c:e.id}})}),T=p.selectAll(".arrow").data(O,function(e){return"a-"+e.p+"-"+e.c});T.enter().append("g").attr("class",function(e){return"arrow arrow-to-"+e.c}).append("path").attr("class",function(e){return"branch-type-"+d(e.c,e.p)});var H=T.select("g>path");H.transition().attr("d",E),T.exit().remove();var P=p.selectAll(".branch").data(d3.values(r.columns).filter(function(e){return e.isVisible()}));P.enter().append("g").attr("class","branch").append("line"),P.select("g>line").transition().attr("class",function(e){return"branch-line "+e.name}).attr("x1",function(e){return A(e.id)}).attr("x2",function(e){return A(e.id)}).attr("y1",k(0)).attr("y2",h.height),P.exit().remove();var R=p.selectAll(".commit").data(d3.values(r.commits).filter(function(e){return e.visible}),function(e){return"c-"+e.id});R.enter().append("g").attr("class","commit").append("circle").attr("class","commit-dot").attr("r",5),R.exit().remove(),R.transition().select("g>circle").attr("cx",function(e){return A(e.columns[0])}).attr("cy",function(e){return k(e.orderNr)}).attr("id",function(e){return"commit-"+e.id});var M=p.selectAll(".legenda-label").data(Object.keys(y)),D=M.enter(),B=D.append("g").attr("class",function(e){return"legenda-label "+y[e].prefix}).append("g").attr("transform",function(e){var t=y[e].first==y[e].last?-10:0;return"translate("+(A(y[e].first)+t)+", "+(k(0)-20)+") rotate(-40)"});B.append("rect").attr("width",60).attr("height",15).attr("rx","2"),B.append("text").attr("y","12").attr("x","3").text(function(e){return e}),M.select("g").transition().attr("transform",function(e){var t=y[e].first==y[e].last?-10:0;return"translate("+(A(y[e].first)+t)+", "+(k(0)-20)+") rotate(-40)"});var S=t.select("div.messages");S.empty()&&(S=t.append("div").attr("class","messages"),S.append("div").attr("class","context-menu"));var j=S.select("div.msg-header");j.empty()&&(j=S.append("div").attr("class","msg-header"),j.append("span").attr("class","branch-btn label aui-lozenge aui-lozenge-subtle").on("click",function(){var e=d3.mouse(S.node());f.show([["Show all",function(){o.hiddenBranches=[],C()}]],e[0],e[1])}));var Y=r.branches.length+r.hiddenBranches.length+" branches";r.hiddenBranches.length>0&&(Y+=" ("+r.hiddenBranches.length+" hidden)"),j.select("span.branch-btn").text(Y);var V=S.selectAll(".commit-msg").data(d3.values(r.commits).filter(function(e){return e.visible}),function(e){return e.id+"-"+e.orderNr});V.enter().append("div").attr("class","commit-msg").attr("id",function(e){return"msg-"+e.id}).on("click",function(t){if("A"==d3.event.target.tagName)return!0;var r=[];if("SPAN"==d3.event.target.tagName){var n="refs/heads/"+d3.event.target.innerHTML;r.push(["Hide branch",function(){o.hiddenBranches.push(n),C()}])}"ancestry"==i.style&&r.push(["Stop highlighting",function(){i.style="none",i.root=null,e.updateHighlight()}]),"ancestry"===i.style&&t.id===i.root||r.push(["Highlight ancestry from here",function(){i.style="ancestry",i.root=t.id,e.updateHighlight()}]);var a=d3.mouse(S.node());f.show(r,a[0],a[1])}),V.exit().remove(),V.html(function(e){var t=o.createCommitUrl(e),r="<table class='commit-table aui'><tr><td class='msg'>";if(e.labels&&_.each(e.labels,function(e){r+=0==e.indexOf("refs/heads/")?0==e.indexOf(o.masterRef)?"<span class='label aui-lozenge aui-lozenge-error aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf(o.developRef)?"<span class='label aui-lozenge aui-lozenge-success aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf(o.featurePrefix)?"<span class='label aui-lozenge aui-lozenge-complete aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf(o.releasePrefix)||0==e.indexOf(o.hotfixPrefix)?"<span class='label aui-lozenge aui-lozenge-current aui-lozenge-subtle'>"+e.substring(11)+"</span>":"<span class='label aui-lozenge aui-lozenge-subtle'>"+e.substring(11)+"</span>":0==e.indexOf("refs/tags/")?"<span class='label aui-lozenge aui-lozenge-moved aui-lozenge-subtle'>"+e.substring(10)+"</span>":"<span class='label aui-lozenge aui-lozenge-subtle'>"+e+"</span>"}),r+=" "+e.message,r+="</td>",e.author){var n=o.createAuthorAvatarUrl(e.author);r+="<td class='author'><span class='aui-avatar aui-avatar-xsmall user-avatar'><span class='aui-avatar-inner'><img src='"+n+"' width='48px' height='48px' /></span></span>"+(e.author.displayName||e.author.name||e.author.emailAddress)+"</td>"}else r+="<td class='author'> </td>";if(e.authorTimestamp){var i=new Date(e.authorTimestamp),a=(new Date).toDateString()===i.toDateString();r+=a?"<td class='date'>"+moment(i).format("HH:mm:ss")+" today</td> ":"<td class='date' title='"+moment(i).format("dddd YYYY-MM-DD HH:mm:ss")+"'>"+moment(i).format("dd YYYY-MM-DD")+"</td> "}return r+="<td class='sha'><a class='commit-link' href='"+t+"' target='_blank'>"+e.displayId+"</a></td> ",r+="</tr></table>"}).transition().attr("style",function(e){var t=e;return"top:"+(k(t.orderNr)-a.rowHeight/2)+"px;"}),e.lazyLoad=function(){var e=null;for(var t in r.openEnds){var n=d3.select("#msg-"+t);if(!n.empty()&&s(n.node())){e=t;break}}if(e){var i=r.commits[e].orderNr;for(var t in r.openEnds)if(!(r.commits[t].orderNr>i+200)){for(var a=0;a<r.openEnds[t].length;a++){var l=r.openEnds[t][a];m[l]=!0,console.log("scheduled: "+l)}delete r.openEnds[t]}for(var t in m)console.log("downloading: "+t),delete m[t],u[t]=!0,o.moreDataCallback(t,function(e,t){delete u[t],e&&w(e),0==Object.keys(m).length&&0==Object.keys(u).length?(console.log("queues empty, ready to draw"),setTimeout(function(){C()},50)):(console.log("waiting, still downloads in progress"),console.log(m),console.log(u))});m={}}}};var m={},u={},d=function(e,t){var n=function(e){var t=r.commits[e];if(!t||0==r.columns.length)return"?";var n=t.columns.map(function(e){return r.columns[e]});return n[0].name[0]},i={m:0,d:1,r:3,f:2},a=[n(e),n(t)];return"d"===a[0]&&"d"!==a[1]?a[1]+" back":(a.sort(function(e,t){return i[t]-i[e]}),a[0]||"default")},f=function(){var e={},t=d3.select(".messages .context-menu"),r=function(){t.empty()&&(t=d3.select(".messages .context-menu"))};return e.show=function(n,i,a){r(),t.style("top",a+"px").style("left",i+"px").style("visibility","visible"),t.selectAll("div.item").remove(),_.each(n,function(r){t.append("div").on("click",function(){r[1](),e.hide()}).attr("class","item").text(r[0])}),d3.event.stopPropagation(),d3.select("body").on("click",function(){e.hide()})},e.hide=function(){r(),t.style("visibility","hidden")},e}();return e}(),n.branches={makeHidden:function(e){if(!(e instanceof Array))throw"pass in refs as an array of strings with full ref descriptors of the branches to hide (like 'refs/heads/develop')";o.hiddenBranches=e,C()},getHidden:function(){return o.hiddenBranches},getAll:function(){return _.map(r.branches,function(e){return{id:e.id,name:e.displayId,lastActivity:e.lastActivity,lastActivityFormatted:moment(e.lastActivity).format("M/D/YY HH:mm:ss")}})}},document&&(d3.select(document).on("scroll resize",function(){GitFlowVisualize.drawing.lazyLoad()}),d3.select(document).on("keydown",function(){var e=d3.event;if(e.ctrlKey&&e.shiftKey&&221==e.which){var t=d3.select("#debug-output");t.empty()&&(t=d3.select("body").append("textarea").attr("id","debug-output")),t.style("display",""),t.node().value=GitFlowVisualize.state(),t.node().focus(),t.node().select(),t.on("blur",function(){t.style("display","none")})}})),n}();